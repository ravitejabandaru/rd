sequenceDiagram
    actor Agent as User (Agent)
    participant SF as Salesforce
    participant IDA as IDAnywhere
    participant FR as iCB ForgeRock
    participant iCB as iCB Case Manager
    participant Florence as Florence Case Manager

    Agent->>SF: Login to Salesforce
    SF->>IDA: SAML Auth Request
    IDA-->>SF: SAML Assertion
    SF->>FR: Request Colleague Token (with SAML)
    FR-->>SF: Return 1hr Colleague Token

    SF->>FR: Token Exchange (Colleague Token + partykey JWT w/ source_role)
    FR-->>SF: Return On-Behalf-Of Token (incl. role claim)

    SF->>iCB: Send OBO Token
    iCB->>Florence: Forward Token
    Florence->>Florence: Enforce RBAC using role from token
