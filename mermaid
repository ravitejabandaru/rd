sequenceDiagram
    actor User
    participant Salesforce
    participant iCB_CaseManager as iCB Case Manager
    participant EgressAuthn as Egress Authn/Authz Facade
    participant AWSSecrets as AWS Secrets Manager
    participant Florence_CaseManager as Florence Case Manager

    User->>Salesforce: Login via SAML
    Salesforce->>iCB_CaseManager: Send JWT (signed request token)
    iCB_CaseManager->>iCB_CaseManager: Extract `source_role` from JWT
    iCB_CaseManager->>EgressAuthn: Request new token with `role` = source_role
    EgressAuthn->>AWSSecrets: Retrieve signing key
    AWSSecrets-->>EgressAuthn: Signing key
    EgressAuthn->>EgressAuthn: Generate JWT with `role` claim
    EgressAuthn-->>iCB_CaseManager: Return signed token

    iCB_CaseManager->>Florence_CaseManager: Send extracted `role`
    Florence_CaseManager->>Florence_CaseManager: Enforce RBAC using role
    Florence_CaseManager-->>User: Grant or deny access
