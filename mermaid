sequenceDiagram
    participant Agent as Agent (Browser)
    participant SF as Salesforce
    participant IDA as IDAnywhere (SAML IdP)
    participant FR as ICB ForgeRock
    participant TMS as ICB TMS
    participant FL as Florence

    Agent->>SF: Login to Salesforce
    SF->>IDA: SAMLRequest
    IDA-->>SF: SAMLResponse (SAML Token)
    SF->>FR: Request Colleague Token (with SAML)
    FR-->>SF: Colleague Token (valid 1hr)

    SF->>TMS: Send JWT signed with party key\n+ Colleague Token
    TMS->>TMS: Validate JWT Signature
    TMS->>TMS: Extract `role` from JWT
    TMS-->>SF: Return OBO Access Token (with role claim)

    SF->>FL: Call Florence with access token
    FL->>FL: Enforce RBAC using role from token
