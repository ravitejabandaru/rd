Architecture Review Decision Ticket
Title: Request to Add role Claim to JWT Issued via Token Exchange
Submitted By: Salesforce Integration Team
Date: [Insert Date]
Environment: Dev/UAT (Phase 1), Production (post-approval)

⸻

1. Summary

This decision ticket proposes a controlled enhancement to the JWT issued by the central Auth platform during the token exchange process. Specifically, we request that a new claim role be added to the response token based on information present in the incoming request token sent by Salesforce.

⸻

2. Current State
	•	Salesforce generates a signed JWT (client assertion)
	•	Submits the JWT to the Auth platform’s /token endpoint (token exchange)
	•	Auth platform issues a new JWT (access token) for downstream API consumption
	•	The current issued token includes standard claims (sub, aud, exp, iat, etc.)
	•	No role or RBAC-enabling claim is present in the response token

⸻

3. Proposed Enhancement
	•	Add a new claim role in the issued JWT from the Auth team
	•	Role should be extracted directly from the incoming request token sent by Salesforce

Example - Request Token from Salesforce:

{
  "sub": "user123",
  "client_id": "salesforce-app",
  "source_role": "case_manager"
}

Example - Issued Token from Auth Platform:

{
  "sub": "user123",
  "aud": "downstream-api",
  "role": "case_manager",
  "exp": 1699999999,
  "iss": "https://auth.internal/jwt"
}


⸻

4. Security Considerations
	•	Request token is signed by Salesforce (private key)
	•	Auth platform performs signature validation and issuer checks
	•	role value is extracted from a trusted field (source_role) in the signed request token
	•	Final issued token remains signed by Auth team
	•	Follows existing OIDC trust boundary and token TTL policies

⸻

5. Impact Assessment
	•	Salesforce: No change to existing request mechanism
	•	Auth Platform: Enhancement to extract and map claim from incoming token
	•	Downstream Consumers: Optional usage of role for RBAC
	•	Backward Compatibility: Maintained — claim is additive, not mandatory

⸻

6. Next Steps & Approval Request
	•	Seek ARGw approval to proceed with Dev/UAT implementation
	•	Post-UAT validation, propose phased rollout to production
	•	Provide documentation and claim format to Auth team
	•	Notify impacted downstream consumers

⸻

7. Decision Required From ARGw
	•	Approval to add role claim to JWT in token exchange flow
	•	Confirm support for extracting role from incoming request token claim (source_role)
	•	Sign-off on Dev/UAT deployment
